# Test Scaffolding Options

These options define where test files are located, whether build steps are needed to move output to
properly import transpiled source files, and how the paths to get to source paths are defined.

The options may drive how package.json and/or tsconfig.json are configured.

## Location Strategy

The type `LocationStrategy` defines the location strategy and there are only three options:

````typescript
export type LocationStrategy =
  'commingled'    // Source files and test files in same folder, ex: src/foo.ts, src/foo.test.ts
  | 'collocated'  // Source files and test files under same root, ex: src/foo.ts, src/bar/bar.ts, src/test/foo.test.ts, src/test//bar/bar.test.ts
  | 'distinct';   // Source files and test files in distinct root folders, ex: src/foo.ts, test/foo.ts
````

Most project will likely select collocated or distinct, but there's nothing wrong with commingled.
In fact, the difference between commingled and collocated is really conceptual.

| Location Strategy | Explanation                                                  | Build System Consequences                                                                                                                                                                                   |
|-------------------|--------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| commingled        | Test files are located in the same directory as their source | - ignores test directory, assumes it is the source directory<br/>- ignores test build settings<br/>- removes commingled test files from distribution that follow the test file pattern<br/>                 |
| collocated        | Test directory is within the source directory                | - for transpilation purposes, ignores test directory<br/>- ignores test build settings<br/>- for testing purposes, assumes test directory points to location under source directory where tests are located |
| distinct          | Test directory is in a directory unrelated to source         | - builds <br/>according to test build settings (which can be different from source)<br/>- outputs tests files  to their own locations.                                                                      |

## Test File Import Strategy

The type `TestFileImportStrategy` defines the import strategy, allowing for these options out of
infinite combinations:

````typescript
export type TestFileImportStrategy =
  'explicit'                // Test import relative paths point explicitly to source locations, which must be matched after transpilation
  | 'distribution'              // Test import relative paths point to the distribution root..i.e.hard coded to point to "dist/.." for example, and types must exist there as well
  | 'self-referencing'      // Test import relative paths point back to the package - moduleResolution = Node16, NodeNext only
  | 'imports'               // Test import relative paths point to imports declarations = moduleResolution = Node16, NodeNext only
  | 'rootDirs'              // Test import relative paths are in a virtual root, different real locations, which must be matched after transpilation
  | 'baseUrl'               // Test import relative paths are relative to a baseUrl, implying collocation/commingling, which must be matched after transpilation
  | 'paths'                 // Test import relative paths are relative to paths mapping, which must be matched after transpilation
````

| Import Strategy  | Explanation                                                                                                                                                                                                                                                                                                                                          | Build Consequences                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| explicit         | Test files explicitly import source files<br/>Generally this is implied <br/>for:<br/>- commingled location strategy<br/>- collocated location strategy                                                                                                                                                                                              | - nothing; assume developer knows what they are doing<br/>- no additional configuration is made other than defined by the location strategy                                                                                                                                                                                                                                                                                                                                                          |
| distribution     | Test files import from distribution folder.  This can be set for all <br/>location strategies but typically is set only for distinct as commingled and collocated have natural import paths.  Note that distribution simply points to the logical distribution, which generally is the location of the package.json that defines conditional exports | - overrides compilationOptions.declaration to true for source file transpilation<br/>- assumes developer is pointing to dist folder in their test source imports                                                                                                                                                                                                                                                                                                                                     |
| self-referencing | Test files import from the package name.  This leverages the self-referencing feature provided by node.js 16+ and moduleResolution= node16 or nodenext.  This import strategy more closely supports package testing (separate option)                                                                                                                | - overrides compilationOptions.moduleResolution to nodenext<br/>overrides declaration to true<br/>works pre-transpilation by definition, and from distribution in the the way the package.json's are defined using conditional exports and location strategy                                                                                                                                                                                                                                         |
| imports          | Test files import from package.json.imports definitions.  This leverages imports features provided by node.js 16+ and moduleResolution= node16 or nodenext                                                                                                                                                                                           | - For source test files, the test file package.json is defined with an imports clause with initial value only as "#dist": "\<path to src\>/index.js, allowing for tests to transpile without having to pre-transpile source, and for ides to not show errors if nothing is transpiled.  Generate test js package.json imports points to distribution<br/>It is up to the developer to add or modify the imports as needed, if all exports don't come from index.js<br/>overrides declaration to true |
| rootDirs         | Test files import are relative to rootDirs for transpilation, and code is moved to make it real for testing purposes                                                                                                                                                                                                                                 | - rootDirs for test files transpilation is set to include source path<br/>- for distinct location strategy a symlinks created to match rootDirs from a test location perspective                                                                                                                                                                                                                                                                                                                     |
| baseUrl          | Test files import are relative to src folder.  This works specifically for commingled and collocated location strategies <br/>only, allowing for paths from base URL.  Moreover there is no benefit for commingled.  The baseUrl compilerOption is set to the src root                                                                               | - baseUrl is setup accordingly<br/> A symlink for transpiled tests files is created to mimic the baseUrl import                                                                                                                                                                                                                                                                                                                                                                                      |
| paths            | Test files import are relative to src folder, as mapped by paths.  No benefit except for distinct location strategy. <br/>compilerOptions baseUrl and paths point to src root and remap path to that src root                                                                                                                                        | - baseUrl and paths setup accordingly<br/>symlinks used to make it a reality at run time                                                                                                                                                                                                                                                                                                                                                                                                             |
  


